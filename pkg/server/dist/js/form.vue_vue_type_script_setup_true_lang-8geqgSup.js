var n=(e,r,l)=>new Promise((c,d)=>{var o=t=>{try{i(l.next(t))}catch(u){d(u)}},f=t=>{try{i(l.throw(t))}catch(u){d(u)}},i=t=>t.done?c(t.value):Promise.resolve(t.value).then(o,f);i((l=l.apply(e,r)).next())});import{bM as p,bK as A}from"./bootstrap-B4JiwaAL.js";import{u as _}from"./form-BUp9oLlJ.js";import{a_ as g,a4 as y,P as b,J as w,aa as C,ab as D,ac as F,x as I,a7 as v}from"../jse/index-index-DnPbrghU.js";import{b as k}from"./role-B1t5w_aH.js";import{u as M}from"./use-modal-CbDtZeLz.js";function B(e){return n(this,null,function*(){return p.get("/user/list",{params:e})})}function N(e,r){return n(this,null,function*(){return p.put(`/user/${e}`,r)})}function q(e){return n(this,null,function*(){return p.post("/user",e)})}function H(e){return n(this,null,function*(){return p.delete(`/user/${e}`)})}function x(){return[{component:"Input",fieldName:"username",label:"用户名",rules:"required"},{component:"Input",fieldName:"password",label:"密码",rules:"required"},{component:"Input",fieldName:"nickname",label:"昵称",rules:"required"},{component:"ApiSelect",componentProps:{allowClear:!0,api:k,class:"w-full",labelField:"name",valueField:"id",childrenField:"children"},fieldName:"roleId",label:"角色ID",rules:"required"},{component:"RadioGroup",componentProps:{buttonStyle:"solid",options:[{label:"启用",value:1},{label:"禁用",value:0}],optionType:"button"},defaultValue:1,fieldName:"status",label:"状态"}]}function L(){return[{field:"username",title:"用户名"},{field:"password",title:"密码"},{field:"nickname",title:"昵称"},{field:"roleId",title:"角色ID"},{field:"status",title:"状态"},{field:"createdAt",title:"创建时间",formatter:({cellValue:e})=>e?g(e).format("YYYY-MM-DD HH:mm:ss"):""},{align:"center",fixed:"right",title:"操作",slots:{default:"action"}}]}const O=y({__name:"form",emits:["success"],setup(e,{emit:r}){const l=r,c=b(),[d,o]=_({schema:x(),showDefaultActions:!1}),f=()=>n(null,null,function*(){const{valid:s}=yield o.validate();if(!s)return;const a=yield o.getValues();m.lock(),(t.value?N(t.value,a):q(a)).then(()=>{l("success"),A.success(`${t.value?"更新":"创建"}成功`),m.close()}).catch(()=>{m.unlock()})}),i=s=>{if(s){const a=m.getData();o.resetForm(),a?(c.value=a,t.value=a.id,o.setValues(a)):t.value=void 0}},t=b(),[u,m]=M({destroyOnClose:!0,onConfirm:f,onOpenChange:i}),h=w(()=>{var s;return(s=c.value)!=null&&s.id?"编辑管理员":"创建管理员"});return(s,a)=>(D(),C(v(u),{title:h.value},{default:F(()=>[I(v(d))]),_:1},8,["title"]))}});export{O as _,H as d,B as g,L as u};
